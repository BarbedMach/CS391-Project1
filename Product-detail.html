<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="title"></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
      <a class="navbar-brand" href="Products.html">Products</a>
      <div class="ms-auto">
        <a href="Shopping-cart.html" class="btn btn-outline-dark">
          <i class="fas fa-shopping-cart"></i>
          <span id="totalAmount"></span>
        </a>
      </div>
    </div>
  </nav>

  <div class="container py-5">
    <h1 id="productTitle"></h1>

    <div class="row">
      <div class="col-md-8">
        <img id="productImage" src="" alt="Product Image" class="img-fluid product-image" />
      </div>
      <div class="col-md-4">
        <p id="productDescription" class="lead"></p>
        <p class="text-muted">Price</p>
        <p id="productPrice" class="h4 text-primary"></p>

        <div class="mt-4">
          <label for="quantity" class="form-label">Quantity:</label>
          <input type="number" id="quantity" class="form-control w-100" />
        </div>

        <button id="addToCartBtn" class="btn btn-dark w-100 mt-3">
          Add to <i class="fas fa-shopping-cart"></i>
        </button>
        <a id="goToCart" class="btn btn-secondary w-100 mt-2" href="Shopping-cart.html">Go to <i
            class="fas fa-shopping-cart"></i></a>
      </div>
    </div>
  </div>

  <footer class="bg-light py-4 mt-5">
    <div class="container">
      <div class="row">
        <h5 class="text-center">Authors</h5>
        <div class="col-md-6">
          <p class="text-muted text-center">Furkan</p>
        </div>
        <div class="col-md-6">
          <p class="text-muted text-center">Selim</p>
        </div>
      </div>
      <hr class="my-4" />
      <div class="row">
        <div class="col-12 text-center">
          <p class="text-muted mb-0">&copy; CS-391 2025 Spring Project 1</p>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script type="text/javascript" src="Products.js"></script>
  <script>
    function getCart() {
      const cart = localStorage.getItem("shoppingCart");
      return cart ? JSON.parse(cart) : {};
    }

    function updateTotalAmount() {
      const cart = getCart();
      let total = 0;

      for (const [productId, item] of Object.entries(cart)) {
        const product = products.find((p) => p.id === parseInt(productId));
        if (product) {
          total += product.price * item.quantity;
        }
      }

      document.getElementById("totalAmount").textContent = `$${total.toFixed(2)}`;
    }

    function saveCart(cart) {
      localStorage.setItem("shoppingCart", JSON.stringify(cart));
      updateTotalAmount();
    }

    window.onload = () => {
      updateTotalAmount();

      const urlParams = new URLSearchParams(window.location.search);
      const productId = Number.parseInt(urlParams.get("id"));
      const product = products.find((p) => p.id == productId);

      if (!product) {
        alert("Product not found!");
        return;
      }

      document.getElementById("title").textContent = product.title;
      document.getElementById("productTitle").textContent = product.title;
      document.getElementById("productDescription").textContent = product.description;
      document.getElementById("productPrice").textContent = `$${product.price.toFixed(2)}`;
      document.getElementById("productImage").src = product.images[0];
      document.getElementById("productImage").alt = product.title;

      document.getElementById("quantity").addEventListener("change", () => {
        updateTotalAmount();
      });

      document.getElementById("addToCartBtn").addEventListener("click", () => {
        const quantity = parseInt(document.getElementById("quantity").value);

        if (quantity <= 0) {
          alert("Please select a quantity greater than 0");
          return;
        }

        const cart = getCart();
        if (quantity > 0) {
          cart[productId] = { productId, quantity };
          saveCart(cart);
          alert("Product added to cart!");
        } else {
          delete cart[productId];
          saveCart(cart);
        }
      });
    };
  </script>
</body>

</html>